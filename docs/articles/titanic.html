<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Surviving the Titanic • easyml</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">easyml</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CCS-Lab/easyml">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Surviving the Titanic</h1>
                        <h4 class="author">Paul Hendricks</h4>
            
            <h4 class="date">2017-06-25</h4>
          </div>

    
    
<div class="contents">
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>In this vignette, we demonstrate the power of <code>easyml</code> using the popular Titanic dataset.</p>
</div>
<div id="load-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-the-data" class="anchor"></a>Load the data</h2>
<p>Install the <code>titanic</code> package from CRAN. This package contains datasets providing information on the fate of passengers on the fatal maiden voyage of the ocean liner “Titanic”, with variables such as economic status (class), sex, age and survival. These data sets are often used as an introduction to machine learning on <a href="https://www.kaggle.com/c/titanic">Kaggle</a>. More details about the dataset can be found there.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(easyml)</code></pre></div>
<pre><code>## Loaded easyml 0.1.0. Also loading ggplot2.</code></pre>
<pre><code>## Loading required namespace: ggplot2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(titanic)
<span class="kw">library</span>(dplyr)</code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)

<span class="kw">data</span>(<span class="st">"titanic_train"</span>, <span class="dt">package =</span> <span class="st">"titanic"</span>)
knitr::<span class="kw">kable</span>(<span class="kw">head</span>(titanic_train))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">PassengerId</th>
<th align="right">Survived</th>
<th align="right">Pclass</th>
<th align="left">Name</th>
<th align="left">Sex</th>
<th align="right">Age</th>
<th align="right">SibSp</th>
<th align="right">Parch</th>
<th align="left">Ticket</th>
<th align="right">Fare</th>
<th align="left">Cabin</th>
<th align="left">Embarked</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="left">Braund, Mr. Owen Harris</td>
<td align="left">male</td>
<td align="right">22</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">A/5 21171</td>
<td align="right">7.2500</td>
<td align="left"></td>
<td align="left">S</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">Cumings, Mrs. John Bradley (Florence Briggs Thayer)</td>
<td align="left">female</td>
<td align="right">38</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">PC 17599</td>
<td align="right">71.2833</td>
<td align="left">C85</td>
<td align="left">C</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="left">Heikkinen, Miss. Laina</td>
<td align="left">female</td>
<td align="right">26</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">STON/O2. 3101282</td>
<td align="right">7.9250</td>
<td align="left"></td>
<td align="left">S</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">Futrelle, Mrs. Jacques Heath (Lily May Peel)</td>
<td align="left">female</td>
<td align="right">35</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">113803</td>
<td align="right">53.1000</td>
<td align="left">C123</td>
<td align="left">S</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="left">Allen, Mr. William Henry</td>
<td align="left">male</td>
<td align="right">35</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">373450</td>
<td align="right">8.0500</td>
<td align="left"></td>
<td align="left">S</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="left">Moran, Mr. James</td>
<td align="left">male</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">330877</td>
<td align="right">8.4583</td>
<td align="left"></td>
<td align="left">Q</td>
</tr>
</tbody>
</table>
</div>
<div id="tidy-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#tidy-the-data" class="anchor"></a>Tidy the data</h2>
<p>To prepare the data for modeling, we will undergo the following steps:</p>
<ol style="list-style-type: decimal">
<li>Filter out any places where <code>Embarked</code> is <code>NA</code>,</li>
<li>Add together <code>SibSp</code>, <code>Parch</code>, and <code>1L</code> to estimate family size,</li>
<li>Create binary variables for each of the 2nd and 3rd class memberships,</li>
<li>Create a binary for gender,</li>
<li>Create binary variables for 2 of the ports of embarkation,</li>
<li>Impute mean values of age where <code>Age</code> is <code>NA</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">titanic_train_2 &lt;-<span class="st"> </span>titanic_train %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(!<span class="kw">is.na</span>(Embarked), Embarked !=<span class="st"> ""</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">Family_Size =</span> SibSp +<span class="st"> </span>Parch +<span class="st"> </span>1L) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">Pclass =</span> <span class="kw">as.character</span>(Pclass)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">Pclass_3 =</span> <span class="dv">1</span> *<span class="st"> </span>(Pclass ==<span class="st"> "3"</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">Sex =</span> <span class="dv">1</span> *<span class="st"> </span>(Sex ==<span class="st"> "male"</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">Embarked_Q =</span> <span class="dv">1</span> *<span class="st"> </span>(Embarked ==<span class="st"> "Q"</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">Embarked_S =</span> <span class="dv">1</span> *<span class="st"> </span>(Embarked ==<span class="st"> "S"</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">Age =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(Age), <span class="kw">mean</span>(Age, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), Age))</code></pre></div>
</div>
<div id="train-a-penalized-logistic-model" class="section level2">
<h2 class="hasAnchor">
<a href="#train-a-penalized-logistic-model" class="anchor"></a>Train a penalized logistic model</h2>
<p>To run an <code>easy_glmnet</code> model, we pass in the following parameters:</p>
<ul>
<li>the data set <code>titanic_train_2</code>,</li>
<li>the name of the dependent variable e.g. <code>Survived</code>,</li>
<li>whether to run a <code>gaussian</code> or a <code>binomial</code> model,</li>
<li>how to preprocess the data; in this case, we use <code>preprocess_scale</code> to scale the data,</li>
<li>which variables to exclude from the analysis,</li>
<li>which variables are categorical variables; these variables are not scaled, if <code>preprocess_scale</code> is used,</li>
<li>the random state,</li>
<li>whether to display a progress bar,</li>
<li>how many cores to run the analysis on in parallel.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.exclude_variables &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"PassengerId"</span>, <span class="st">"Pclass"</span>, <span class="st">"Name"</span>, 
                        <span class="st">"Ticket"</span>, <span class="st">"Cabin"</span>, <span class="st">"Embarked"</span>)
.categorical_variables &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Sex"</span>, <span class="st">"SibSp"</span>, <span class="st">"Parch"</span>, <span class="st">"Family_Size"</span>, 
                            <span class="st">"Pclass_3"</span>, <span class="st">"Embarked_Q"</span>, <span class="st">"Embarked_S"</span>)
results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/easy_glmnet.html">easy_glmnet</a></span>(titanic_train_2, <span class="st">"Survived"</span>, 
                       <span class="dt">family =</span> <span class="st">"binomial"</span>, 
                       <span class="dt">preprocess =</span> preprocess_scale, 
                       <span class="dt">exclude_variables =</span> .exclude_variables, 
                       <span class="dt">categorical_variables =</span> .categorical_variables, 
                       <span class="dt">random_state =</span> <span class="dv">12345</span>, <span class="dt">progress_bar =</span> <span class="ot">FALSE</span>, 
                       <span class="dt">n_samples =</span> <span class="dv">10</span>, <span class="dt">n_divisions =</span> <span class="dv">10</span>, 
                       <span class="dt">n_iterations =</span> <span class="dv">2</span>, <span class="dt">n_core =</span> <span class="dv">1</span>)</code></pre></div>
</div>
<div id="assess-results" class="section level2">
<h2 class="hasAnchor">
<a href="#assess-results" class="anchor"></a>Assess results</h2>
<p>Now let’s assess the results of the <code>easy_glmnet</code> model.</p>
<div id="estimates-of-weights" class="section level3">
<h3 class="hasAnchor">
<a href="#estimates-of-weights" class="anchor"></a>Estimates of weights</h3>
<p>We can interpret the weights in the following way:</p>
<ul>
<li>A 1 standard deviation increase in <code>Fare</code> increases the log-odds of survival by 0.14 units,</li>
<li>A 1 standard deviation increase in <code>Age</code> decreases the log-odds of survival by 0.47 units,</li>
<li>If a passenger embarked at the Southampton port, the log-odds of survival decrease by 0.40 units,</li>
<li>If a passenger is third class, the log-odds of survival decrease by 1.98 units,</li>
<li>If a passenger is second class, the log-odds of survival decrease by 0.77 units,</li>
<li>For every unit increase in a passenger’s family size, the log-odds of survival decrease by 0.10 units,</li>
<li>For every additional Sibling or Spouse in a passenger’s family, the log-odds of survival decrease by 0.21 units,</li>
<li>If a passenger is male, the log-odds of survival decrease by 2.64 units.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results$plot_coefficients</code></pre></div>
<p><img src="titanic_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output &lt;-<span class="st"> </span>results$coefficients_processed
knitr::<span class="kw">kable</span>(output[<span class="kw">nrow</span>(output):<span class="dv">1</span>, ], <span class="dt">digits  =</span> <span class="dv">2</span>)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="left">predictor</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">lower_bound</th>
<th align="right">upper_bound</th>
<th align="right">survival</th>
<th align="right">sig</th>
<th align="right">dot_color_1</th>
<th align="right">dot_color_2</th>
<th align="left">dot_color</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>9</td>
<td align="left">Fare</td>
<td align="right">0.25</td>
<td align="right">0.01</td>
<td align="right">0.23</td>
<td align="right">0.27</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td>8</td>
<td align="left">Age</td>
<td align="right">-0.37</td>
<td align="right">0.01</td>
<td align="right">-0.39</td>
<td align="right">-0.35</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td>7</td>
<td align="left">Embarked_S</td>
<td align="right">-0.47</td>
<td align="right">0.01</td>
<td align="right">-0.50</td>
<td align="right">-0.45</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td>6</td>
<td align="left">Embarked_Q</td>
<td align="right">0.00</td>
<td align="right">0.01</td>
<td align="right">-0.02</td>
<td align="right">0.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td>5</td>
<td align="left">Pclass_3</td>
<td align="right">-1.44</td>
<td align="right">0.02</td>
<td align="right">-1.47</td>
<td align="right">-1.41</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td>4</td>
<td align="left">Family_Size</td>
<td align="right">-0.09</td>
<td align="right">0.01</td>
<td align="right">-0.11</td>
<td align="right">-0.08</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td>3</td>
<td align="left">Parch</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td>2</td>
<td align="left">SibSp</td>
<td align="right">-0.17</td>
<td align="right">0.01</td>
<td align="right">-0.18</td>
<td align="right">-0.16</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td>1</td>
<td align="left">Sex</td>
<td align="right">-2.53</td>
<td align="right">0.03</td>
<td align="right">-2.57</td>
<td align="right">-2.50</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">2</td>
</tr>
</tbody>
</table>
</div>
<div id="predictions-roc-curve" class="section level3">
<h3 class="hasAnchor">
<a href="#predictions-roc-curve" class="anchor"></a>Predictions: ROC Curve</h3>
<p>We can examine both the in-sample and out-of-sample ROC curve plots for one particular trian-test split determined by the random state and determine the Area Under the Curve (AUC) as a goodness of fit metric. Here, we see that the in-sample AUC is higher than the out-of-sample AUC, but that both metrics indicate the model fits relatively well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results$plot_predictions_single_train_test_split_train</code></pre></div>
<p><img src="titanic_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results$plot_predictions_single_train_test_split_test</code></pre></div>
<p><img src="titanic_files/figure-html/unnamed-chunk-5-2.png" width="672"></p>
</div>
<div id="metrics-auc" class="section level3">
<h3 class="hasAnchor">
<a href="#metrics-auc" class="anchor"></a>Metrics: AUC</h3>
<p>We can examine both the in-sample and out-of-sample AUC metrics for <code>n_divisions</code> train-test splits (ususally defaults to 1,000). Again, we see that the in-sample AUC is higher than the out-of-sample AUC, but that both metrics indicate the model fits relatively well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results$plot_model_performance_train</code></pre></div>
<p><img src="titanic_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results$plot_model_performance_test</code></pre></div>
<p><img src="titanic_files/figure-html/unnamed-chunk-6-2.png" width="672"></p>
</div>
</div>
<div id="discuss" class="section level2">
<h2 class="hasAnchor">
<a href="#discuss" class="anchor"></a>Discuss</h2>
<p>In this vignette we used <code>easyml</code> to easily build and evaluate a penalized binomial regression model to assess the likelihood of passenger surival given a number of attributes. We can continue to finetune the model and identify the most optimal alpha/lambda hyperparameter combination; however, our estimates of the weights make intutive sense and a mean out-of-sample AUC of 0.85 right off the bat is indicative of a good model.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#load-the-data">Load the data</a></li>
      <li><a href="#tidy-the-data">Tidy the data</a></li>
      <li><a href="#train-a-penalized-logistic-model">Train a penalized logistic model</a></li>
      <li><a href="#assess-results">Assess results</a></li>
      <li><a href="#discuss">Discuss</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Woo-Young Ahn, Paul Hendricks.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
